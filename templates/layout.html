<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Pinson Travel{% endblock %}</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/datepicker.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            tajawal: ['Tajawal', 'sans-serif'],
          },
          colors: {
            primary: '#2f855a',
            accent: '#c6f6d5',
            neutral: '#f7fafc',
            dark: '#1a202c',
            danger: '#e53e3e',
          }
        }
      }
    }
  </script>

  <style>
    input, textarea {
      text-transform: uppercase;
      font-size: 1rem;
    }
    input:focus, textarea:focus {
      font-size: 1.05rem;
    }
  </style>
</head>

<body class="font-tajawal bg-neutral text-dark overflow-x-hidden">
<div class="flex min-h-screen">

  <!-- Sidebar -->
  <aside class="w-64 bg-primary text-white flex flex-col py-4 px-4 shadow-2xl">

    <!-- Logo -->
    <div class="text-center mb-4">
      <img src="{{ url_for('static', filename='logo.png') }}" class="w-32 h-auto mx-auto" alt="Logo">
    </div>

    <!-- Navigation -->
{% set is_admin = session.get('role') == 'admin' %}
<nav class="space-y-2 text-sm">
  {% set nav_items = [
    ('dashboard', 'لوحة الإحصائيات', 'dashboard.svg', True),
    ('add_client', 'إضافة عميل', 'add-clients.svg', True),
    ('countries', 'البلدان', 'countries.svg', False),
    ('agents', 'الوسطاء', 'agents.svg', True),
    ('add_countries', 'إضافة بلد', 'map.svg', False)
  ] %}

  {% for route, label, icon, white_icon in nav_items %}
    {% if route != 'add_countries' or is_admin %}
    <a href="{{ url_for(route) }}"
       class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-dark hover:text-white transition {{ 'bg-dark text-white' if request.endpoint == route else '' }}">
      <img src="{{ url_for('static', filename='icons/' ~ icon) }}"
           class="w-5 h-5 {{ 'brightness-0 invert' if white_icon else '' }}" alt="">
      <span>{{ label }}</span>
    </a>
    {% endif %}
  {% endfor %}
</nav>


   <!-- Logout Button -->
<div class="mt-auto border-t border-white/20 pt-4">
  <a href="{{ url_for('logout') }}"
     class="flex items-center justify-center gap-2 px-4 py-3 bg-danger text-white rounded-lg hover:bg-red-500 transition text-sm font-medium">
    <img src="{{ url_for('static', filename='icons/logout.svg') }}" class="w-5 h-5 brightness-0 invert" alt="">
    <span>تسجيل الخروج</span>
  </a>
</div>

  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-4 sm:p-6 lg:p-10 overflow-auto">

    <!-- Flash Messages with categories -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="space-y-3 mb-4">
      {% for category, message in messages %}
      <div class="flex items-center gap-3 bg-accent border-l-4 px-4 py-2 text-sm shadow rounded text-dark
                  {% if category == 'success' %}border-green-600{% elif category == 'danger' %}border-red-600{% else %}border-primary{% endif %}">
        {% if category == 'success' %}
          <span class="text-green-600 font-bold">✔</span>
        {% elif category == 'danger' %}
          <span class="text-red-600 font-bold">⚠</span>
        {% else %}
          <span class="text-primary font-bold">ℹ</span>
        {% endif %}
        <span>{{ message }}</span>
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% block scripts %}{% endblock %}
</body>
</html>
